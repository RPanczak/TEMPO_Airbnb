---
title: "Airbnb - seasonality"
subtitle: "Using GNO"
# author: "Radoslaw Panczak"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
  html_document: 
    highlight: pygments
    number_sections: yes
    theme: united
    toc: yes
    toc_depth: 4
---

<!-- ------------------------------------------------------------ --> 
<!-- ------------------------------------------------------------ --> 

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, fig.width=6, fig.height=3.75, dpi=300, out.width="600px", out.height="375px")

knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())
set.seed(12345)
options(scipen = 999)

library(pacman) 
p_load(tidyverse, magrittr, forecast)

```

# Data 

```{r}
airbnb_new_bookings_monthly <- readRDS(file = "./data/airdna/clean/airbnb_new_bookings_monthly.rds")

airbnb_month_agg <- airbnb_new_bookings_monthly %>% 
  mutate(temp = reservation_days * max_guests) %>% 
  group_by(reporting_month) %>% 
  summarise(
    # number_of_reservations = sum(number_of_reservations, na.rm = TRUE),
    # reservation_days = sum(reservation_days, na.rm = TRUE),
    # revenue_native = sum(revenue_native, na.rm = TRUE),
    max_gno = sum(temp, na.rm = TRUE)
  ) 

# write_csv(airbnb_month_agg, "C:/Users/uqrpancz/Desktop/upload.csv")
```

`r nrow(airbnb_month_agg)` records of monthly aggregated GNO values for whole Oz. 

# Time series

```{r}
gno_ts = ts(airbnb_month_agg[[2]], start = c(2016, 1), frequency = 12)
ggplot2::autoplot(gno_ts)
ggseasonplot(gno_ts)#, polar=TRUE)
ggAcf(gno_ts)
```

```{r}
# monthplot(gno_ts)
```

# Seasonality

## `decompose` function `stats` package

```{r}
gno_ts %>% decompose(type="multi") %>%
  autoplot() + xlab("") 
```


## `stl` function `stats` package

```{r}
stl(gno_ts, s.window="per", robust=TRUE) %>% 
  autoplot() + xlab("") 
```


## `AutoSTR` function `stR` package

```{r}
p_load(stR)
```

```{r}
plot(AutoSTR(gno_ts))
```

## `seasonal` package `x11` method

```{r}
p_load(seasonal)

gno <- seas(gno_ts, x11="")

autoplot(gno)

# p_load(seasonalview)
# view(gno)
```

## `seasonal` package `SEATS` method

```{r}
gno <- seas(gno_ts)

autoplot(gno)
# view(gno)
```









