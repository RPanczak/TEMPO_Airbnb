---
title: "ABS tourist accomodation data 02"
author: "Radoslaw Panczak"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
  html_document: 
    highlight: pygments
    number_sections: yes
    theme: united
    toc: yes
    toc_depth: 4
---

<link rel="stylesheet" href="http://vis.supstat.com/assets/themes/dinky/css/scianimator.css">

<!-- ------------------------------------------------------------ --> 
<!-- ------------------------------------------------------------ --> 

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, fig.width=8, fig.height=6, dpi=300, out.width="800px", out.height="600px")
knitr::opts_knit$set(root.dir = '\\\\gpem-atlas2/QCPR/Projects/ABS Linkage')

# setwd('\\\\gpem-atlas2/QCPR/Projects/ABS Linkage')

set.seed(12345)

library(tidyverse)
library(readxl)
library(lubridate)
library(magrittr)

library(rgdal)
library(rgeos)
library(tmap) # library(RColorBrewer)
tmap_mode("view") # makes map interactive
# library(sf)

library(statar)
library(geofacet)
library(skimr)
```


```{r geodata_prep, eval=FALSE}
library(rmapshaper)

# TR 2015 outlines 
TR15 <- readOGR("./Data/geo/ABS/raw/1270055003_tr_2015_aust_shape", "TR_2015_AUST", verbose = TRUE)
class(TR15); nrow(TR15@data); names(TR15@data)
# View(TR15@data)
# qtm(TR15)
proj4string(TR15)

TR15$AREA_SQKM <- NULL

TR15 <- ms_simplify(TR15, keep = 0.05, weighting = 0.7) # default settings

qtm(TR15)
class(TR15); nrow(TR15@data)
proj4string(TR15)

# writeOGR(TR15, "./Data/geo/ABS/clean", "TR_2015_AUST_clean", driver="ESRI Shapefile", overwrite_layer=TRUE)
saveRDS(TR15, file = "./Data/geo/ABS/clean/TR_2015_AUST.rds")
```



```{r geodata_load, include=FALSE}
# TR 2015
TR15 <- readRDS(file = "./Data/geo/ABS/clean/TR_2015_AUST.rds")
# TR15_f <- broom::tidy(TR15)
table(duplicated(TR15$TR_CODE15))

# TR15_f <- broom::tidy(TR15)

# centroids from arcgis - prepared with option 'inside'
TR15_centr <- readOGR("./Data/geo/ABS/raw/1270055003_tr_2015_aust_shape", "TR_2015_AUST_centr", verbose = TRUE)
# class(TR15_centr); nrow(TR15_centr@data); proj4string(TR15_centr)
# qtm(TR15_centr)
# View(TR15_centr@data)

# STATES
STE <- readRDS(file = "./Data/geo/ABS/clean/STE_2016_AUST.rds")

# removing other teritories
STE <- STE[STE$STE_CODE16 != 9, ] 

# states_f <- broom::tidy(states)

# qtm(STE)
# View(STE@data)
```

<!-- ------------------------------------------------------------ --> 
<!-- ------------------------------------------------------------ --> 

# Summary 

This is an overview of data preparation for '8635.0 - Tourist Accommodation, Australia, 2015-16' [dataset](http://www.abs.gov.au/AUSSTATS/abs@.nsf/Lookup/8635.0Main+Features12015-16?OpenDocument) from ABS.

In contrast to version 1 which prepared the data on SA2 level, this work uses states and Tourism Regions (version 2015) as spatial reference.  

Additionally, more detail on type of accomodation is included.

<!-- ------------------------------------------------------------ --> 
<!-- ------------------------------------------------------------ --> 


# Data preparation

## Raw data

Data are openly available. Unfortunately they can only be dowloaded in form of horribly designed spreadsheets:

![](./images/TA_TR.png)

<br>
Note the empty cells! Comment for them says:

> *not available for publication but included in totals where applicable, unless otherwise indicated*

That can bias 

## State level data

- Monthly values of **Guest Nights Occupied** (GNO) and **Room nights occupied**  (RNO) were extracted
- These two figures were used to create monthly value of people per room as PPR = GNO / RNO
- PPR was calculated for three types of accomodation captured by the survey

```{r, include=FALSE}
# ACT
ACT_1 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/ACT.xls", 
                    sheet = "Table_2", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `RNO_2015-07` = `no.__3`,  `RNO_2015-08` = `no.__4`,  `RNO_2015-09` = `no.__5`, 
                `GNO_2015-07` = `no.__11`, `GNO_2015-08` = `no.__12`, `GNO_2015-09` = `no.__13`) %>% 
  select(Category, contains("NO", ignore.case = FALSE)) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(STE_NAME16 = ifelse(test = Category == "Total Accommodation", yes = "Australian Capital Territory", no = NA)) %>% 
  tidyr::fill(STE_NAME16) %>% 
  filter(STE_NAME16 == "Australian Capital Territory") %>% 
  filter(Category != "Total Accommodation") %>% 
  dplyr::mutate(`2015-07` = `GNO_2015-07`/`RNO_2015-07`, `2015-08` = `GNO_2015-08`/`RNO_2015-08`, `2015-09` = `GNO_2015-09`/`RNO_2015-09`) %>% 
  dplyr::select(STE_NAME16, Category, starts_with("20")) %>% 
  gather(`2015-07`:`2015-09`, key = "date", value = "PPR") %>% 
  select(STE_NAME16, date, everything()) %>% 
  arrange(STE_NAME16, date, Category)


ACT_2 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/ACT.xls", 
                    sheet = "Table_3", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `RNO_2015-10` = `no.__3`,  `RNO_2015-11` = `no.__4`,  `RNO_2015-12` = `no.__5`, 
                `GNO_2015-10` = `no.__11`, `GNO_2015-11` = `no.__12`, `GNO_2015-12` = `no.__13`) %>% 
  select(Category, contains("NO", ignore.case = FALSE)) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(STE_NAME16 = ifelse(test = Category == "Total Accommodation", yes = "Australian Capital Territory", no = NA)) %>% 
  tidyr::fill(STE_NAME16) %>% 
  filter(STE_NAME16 == "Australian Capital Territory") %>% 
  filter(Category != "Total Accommodation") %>% 
  dplyr::mutate(`2015-10` = `GNO_2015-10`/`RNO_2015-10`, 
                `2015-11` = `GNO_2015-11`/`RNO_2015-11`, 
                `2015-12` = `GNO_2015-12`/`RNO_2015-12`) %>% 
  dplyr::select(STE_NAME16, Category, starts_with("20")) %>% 
  gather(`2015-10`:`2015-12`, key = "date", value = "PPR") %>% 
  select(STE_NAME16, date, everything()) %>% 
  arrange(STE_NAME16, date, Category)


ACT_3 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/ACT.xls", 
                    sheet = "Table_4", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `RNO_2016-01` = `no.__3`,  `RNO_2016-02` = `no.__4`,  `RNO_2016-03` = `no.__5`, 
                `GNO_2016-01` = `no.__11`, `GNO_2016-02` = `no.__12`, `GNO_2016-03` = `no.__13`) %>% 
  select(Category, contains("NO", ignore.case = FALSE)) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(STE_NAME16 = ifelse(test = Category == "Total Accommodation", yes = "Australian Capital Territory", no = NA)) %>% 
  tidyr::fill(STE_NAME16) %>% 
  filter(STE_NAME16 == "Australian Capital Territory") %>% 
  filter(Category != "Total Accommodation") %>% 
  dplyr::mutate(`2016-01` = `GNO_2016-01`/`RNO_2016-01`, 
                `2016-02` = `GNO_2016-02`/`RNO_2016-02`, 
                `2016-03` = `GNO_2016-03`/`RNO_2016-03`) %>% 
  dplyr::select(STE_NAME16, Category, starts_with("20")) %>% 
  gather(`2016-01`:`2016-03`, key = "date", value = "PPR") %>% 
  select(STE_NAME16, date, everything()) %>% 
  arrange(STE_NAME16, date, Category)


ACT_4 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/ACT.xls", 
                    sheet = "Table_5", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `RNO_2016-04` = `no.__3`,  `RNO_2016-05` = `no.__4`,  `RNO_2016-06` = `no.__5`, 
                `GNO_2016-04` = `no.__11`, `GNO_2016-05` = `no.__12`, `GNO_2016-06` = `no.__13`) %>% 
  select(Category, contains("NO", ignore.case = FALSE)) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(STE_NAME16 = ifelse(test = Category == "Total Accommodation", yes = "Australian Capital Territory", no = NA)) %>% 
  tidyr::fill(STE_NAME16) %>% 
  filter(STE_NAME16 == "Australian Capital Territory") %>% 
  filter(Category != "Total Accommodation") %>% 
  dplyr::mutate(`2016-04` = `GNO_2016-04`/`RNO_2016-04`, 
                `2016-05` = `GNO_2016-05`/`RNO_2016-05`, 
                `2016-06` = `GNO_2016-06`/`RNO_2016-06`) %>% 
  dplyr::select(STE_NAME16, Category, starts_with("20")) %>% 
  gather(`2016-04`:`2016-06`, key = "date", value = "PPR") %>% 
  select(STE_NAME16, date, everything()) %>% 
  arrange(STE_NAME16, date, Category)


ACT <- rbind(ACT_1, ACT_2, ACT_3, ACT_4) %>% 
  mutate(State_short = "ACT") %>% 
  filter(Category != "Hotels, motels and serviced apartments")

rm(ACT_1, ACT_2, ACT_3, ACT_4)

# NSW
# for some bizzare reason original xsl file was not able to open in R despite working in excell
# file was saved as xslx without any modifications ant now it works - beats me o_O
NSW_1 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/NSW.xlsx", 
                    sheet = "Table_6", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `RNO_2015-07` = `no.__3`,  `RNO_2015-08` = `no.__4`,  `RNO_2015-09` = `no.__5`, 
                `GNO_2015-07` = `no.__11`, `GNO_2015-08` = `no.__12`, `GNO_2015-09` = `no.__13`) %>% 
  select(Category, contains("NO", ignore.case = FALSE)) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(STE_NAME16 = ifelse(test = Category == "New South Wales", yes = "New South Wales", no = NA)) %>% 
  tidyr::fill(STE_NAME16) %>% 
  filter(STE_NAME16 == "New South Wales") %>% 
  filter(Category != "Hotels, motels and serviced apartments") %>% 
  filter(Category != STE_NAME16) %>% 
  dplyr::mutate(`2015-07` = `GNO_2015-07`/`RNO_2015-07`, `2015-08` = `GNO_2015-08`/`RNO_2015-08`, `2015-09` = `GNO_2015-09`/`RNO_2015-09`) %>% 
  dplyr::select(STE_NAME16, Category, starts_with("20")) %>% 
  gather(`2015-07`:`2015-09`, key = "date", value = "PPR") %>% 
  select(STE_NAME16, date, everything()) %>% 
  arrange(STE_NAME16, date, Category)


NSW_2 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/NSW.xlsx", 
                    sheet = "Table_7", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `RNO_2015-10` = `no.__3`,  `RNO_2015-11` = `no.__4`,  `RNO_2015-12` = `no.__5`, 
                `GNO_2015-10` = `no.__11`, `GNO_2015-11` = `no.__12`, `GNO_2015-12` = `no.__13`) %>% 
  select(Category, contains("NO", ignore.case = FALSE)) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(STE_NAME16 = ifelse(test = Category == "New South Wales", yes = "New South Wales", no = NA)) %>% 
  tidyr::fill(STE_NAME16) %>% 
  filter(STE_NAME16 == "New South Wales") %>% 
  filter(Category != "Hotels, motels and serviced apartments") %>% 
  filter(Category != STE_NAME16) %>% 
  dplyr::mutate(`2015-10` = `GNO_2015-10`/`RNO_2015-10`, 
                `2015-11` = `GNO_2015-11`/`RNO_2015-11`, 
                `2015-12` = `GNO_2015-12`/`RNO_2015-12`) %>% 
  dplyr::select(STE_NAME16, Category, starts_with("20")) %>% 
  gather(`2015-10`:`2015-12`, key = "date", value = "PPR") %>% 
  select(STE_NAME16, date, everything()) %>% 
  arrange(STE_NAME16, date, Category)


NSW_3 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/NSW.xlsx", 
                    sheet = "Table_7", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `RNO_2016-01` = `no.__3`,  `RNO_2016-02` = `no.__4`,  `RNO_2016-03` = `no.__5`, 
                `GNO_2016-01` = `no.__11`, `GNO_2016-02` = `no.__12`, `GNO_2016-03` = `no.__13`) %>% 
  select(Category, contains("NO", ignore.case = FALSE)) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(STE_NAME16 = ifelse(test = Category == "New South Wales", yes = "New South Wales", no = NA)) %>% 
  tidyr::fill(STE_NAME16) %>% 
  filter(STE_NAME16 == "New South Wales") %>% 
  filter(Category != "Hotels, motels and serviced apartments") %>% 
  filter(Category != STE_NAME16) %>% 
  dplyr::mutate(`2016-01` = `GNO_2016-01`/`RNO_2016-01`, 
                `2016-02` = `GNO_2016-02`/`RNO_2016-02`, 
                `2016-03` = `GNO_2016-03`/`RNO_2016-03`) %>% 
  dplyr::select(STE_NAME16, Category, starts_with("20")) %>% 
  gather(`2016-01`:`2016-03`, key = "date", value = "PPR") %>% 
  select(STE_NAME16, date, everything()) %>% 
  arrange(STE_NAME16, date, Category)


NSW_4 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/NSW.xlsx", 
                    sheet = "Table_8", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `RNO_2016-04` = `no.__3`,  `RNO_2016-05` = `no.__4`,  `RNO_2016-06` = `no.__5`, 
                `GNO_2016-04` = `no.__11`, `GNO_2016-05` = `no.__12`, `GNO_2016-06` = `no.__13`) %>% 
  select(Category, contains("NO", ignore.case = FALSE)) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(STE_NAME16 = ifelse(test = Category == "New South Wales", yes = "New South Wales", no = NA)) %>% 
  tidyr::fill(STE_NAME16) %>% 
  filter(STE_NAME16 == "New South Wales") %>% 
  filter(Category != "Hotels, motels and serviced apartments") %>% 
  filter(Category != STE_NAME16) %>% 
  dplyr::mutate(`2016-04` = `GNO_2016-04`/`RNO_2016-04`, 
                `2016-05` = `GNO_2016-05`/`RNO_2016-05`, 
                `2016-06` = `GNO_2016-06`/`RNO_2016-06`) %>% 
  dplyr::select(STE_NAME16, Category, starts_with("20")) %>% 
  gather(`2016-04`:`2016-06`, key = "date", value = "PPR") %>% 
  select(STE_NAME16, date, everything()) %>% 
  arrange(STE_NAME16, date, Category)


NSW <- rbind(NSW_1, NSW_2, NSW_3, NSW_4) %>% 
  mutate(State_short = "NSW") 

rm(NSW_1, NSW_2, NSW_3, NSW_4)


# NT
NT_1 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/NT.xls", 
                   sheet = "Table_6", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `RNO_2015-07` = `no.__3`,  `RNO_2015-08` = `no.__4`,  `RNO_2015-09` = `no.__5`, 
                `GNO_2015-07` = `no.__11`, `GNO_2015-08` = `no.__12`, `GNO_2015-09` = `no.__13`) %>% 
  select(Category, contains("NO", ignore.case = FALSE)) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(STE_NAME16 = ifelse(test = Category == "Northern Territory", yes = "Northern Territory", no = NA)) %>% 
  tidyr::fill(STE_NAME16) %>% 
  filter(STE_NAME16 == "Northern Territory") %>% 
  filter(Category != "Hotels, motels and serviced apartments") %>% 
  filter(Category != STE_NAME16) %>% 
  dplyr::mutate(`2015-07` = `GNO_2015-07`/`RNO_2015-07`, `2015-08` = `GNO_2015-08`/`RNO_2015-08`, `2015-09` = `GNO_2015-09`/`RNO_2015-09`) %>% 
  dplyr::select(STE_NAME16, Category, starts_with("20")) %>% 
  gather(`2015-07`:`2015-09`, key = "date", value = "PPR") %>% 
  select(STE_NAME16, date, everything()) %>% 
  arrange(STE_NAME16, date, Category)


NT_2 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/NT.xls", 
                   sheet = "Table_7", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `RNO_2015-10` = `no.__3`,  `RNO_2015-11` = `no.__4`,  `RNO_2015-12` = `no.__5`, 
                `GNO_2015-10` = `no.__11`, `GNO_2015-11` = `no.__12`, `GNO_2015-12` = `no.__13`) %>% 
  select(Category, contains("NO", ignore.case = FALSE)) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(STE_NAME16 = ifelse(test = Category == "Northern Territory", yes = "Northern Territory", no = NA)) %>% 
  tidyr::fill(STE_NAME16) %>% 
  filter(STE_NAME16 == "Northern Territory") %>% 
  filter(Category != "Hotels, motels and serviced apartments") %>% 
  filter(Category != STE_NAME16) %>% 
  dplyr::mutate(`2015-10` = `GNO_2015-10`/`RNO_2015-10`, 
                `2015-11` = `GNO_2015-11`/`RNO_2015-11`, 
                `2015-12` = `GNO_2015-12`/`RNO_2015-12`) %>% 
  dplyr::select(STE_NAME16, Category, starts_with("20")) %>% 
  gather(`2015-10`:`2015-12`, key = "date", value = "PPR") %>% 
  select(STE_NAME16, date, everything()) %>% 
  arrange(STE_NAME16, date, Category)


NT_3 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/NT.xls", 
                   sheet = "Table_7", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `RNO_2016-01` = `no.__3`,  `RNO_2016-02` = `no.__4`,  `RNO_2016-03` = `no.__5`, 
                `GNO_2016-01` = `no.__11`, `GNO_2016-02` = `no.__12`, `GNO_2016-03` = `no.__13`) %>% 
  select(Category, contains("NO", ignore.case = FALSE)) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(STE_NAME16 = ifelse(test = Category == "Northern Territory", yes = "Northern Territory", no = NA)) %>% 
  tidyr::fill(STE_NAME16) %>% 
  filter(STE_NAME16 == "Northern Territory") %>% 
  filter(Category != "Hotels, motels and serviced apartments") %>% 
  filter(Category != STE_NAME16) %>% 
  dplyr::mutate(`2016-01` = `GNO_2016-01`/`RNO_2016-01`, 
                `2016-02` = `GNO_2016-02`/`RNO_2016-02`, 
                `2016-03` = `GNO_2016-03`/`RNO_2016-03`) %>% 
  dplyr::select(STE_NAME16, Category, starts_with("20")) %>% 
  gather(`2016-01`:`2016-03`, key = "date", value = "PPR") %>% 
  select(STE_NAME16, date, everything()) %>% 
  arrange(STE_NAME16, date, Category)


NT_4 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/NT.xls", 
                   sheet = "Table_8", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `RNO_2016-04` = `no.__3`,  `RNO_2016-05` = `no.__4`,  `RNO_2016-06` = `no.__5`, 
                `GNO_2016-04` = `no.__11`, `GNO_2016-05` = `no.__12`, `GNO_2016-06` = `no.__13`) %>% 
  select(Category, contains("NO", ignore.case = FALSE)) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(STE_NAME16 = ifelse(test = Category == "Northern Territory", yes = "Northern Territory", no = NA)) %>% 
  tidyr::fill(STE_NAME16) %>% 
  filter(STE_NAME16 == "Northern Territory") %>% 
  filter(Category != "Hotels, motels and serviced apartments") %>% 
  filter(Category != STE_NAME16) %>% 
  dplyr::mutate(`2016-04` = `GNO_2016-04`/`RNO_2016-04`, 
                `2016-05` = `GNO_2016-05`/`RNO_2016-05`, 
                `2016-06` = `GNO_2016-06`/`RNO_2016-06`) %>% 
  dplyr::select(STE_NAME16, Category, starts_with("20")) %>% 
  gather(`2016-04`:`2016-06`, key = "date", value = "PPR") %>% 
  select(STE_NAME16, date, everything()) %>% 
  arrange(STE_NAME16, date, Category)


NT <- rbind(NT_1, NT_2, NT_3, NT_4) %>% 
  mutate(State_short = "NT") 

rm(NT_1, NT_2, NT_3, NT_4)


# Qld
Qld_1 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/Qld.xlsx", 
                    sheet = "Table_6", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `RNO_2015-07` = `no.__3`,  `RNO_2015-08` = `no.__4`,  `RNO_2015-09` = `no.__5`, 
                `GNO_2015-07` = `no.__11`, `GNO_2015-08` = `no.__12`, `GNO_2015-09` = `no.__13`) %>% 
  select(Category, contains("NO", ignore.case = FALSE)) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(STE_NAME16 = ifelse(test = Category == "Queensland", yes = "Queensland", no = NA)) %>% 
  tidyr::fill(STE_NAME16) %>% 
  filter(STE_NAME16 == "Queensland") %>% 
  filter(Category != "Hotels, motels and serviced apartments") %>% 
  filter(Category != STE_NAME16) %>% 
  dplyr::mutate(`2015-07` = `GNO_2015-07`/`RNO_2015-07`, `2015-08` = `GNO_2015-08`/`RNO_2015-08`, `2015-09` = `GNO_2015-09`/`RNO_2015-09`) %>% 
  dplyr::select(STE_NAME16, Category, starts_with("20")) %>% 
  gather(`2015-07`:`2015-09`, key = "date", value = "PPR") %>% 
  select(STE_NAME16, date, everything()) %>% 
  arrange(STE_NAME16, date, Category)


Qld_2 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/Qld.xlsx", 
                    sheet = "Table_7", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `RNO_2015-10` = `no.__3`,  `RNO_2015-11` = `no.__4`,  `RNO_2015-12` = `no.__5`, 
                `GNO_2015-10` = `no.__11`, `GNO_2015-11` = `no.__12`, `GNO_2015-12` = `no.__13`) %>% 
  select(Category, contains("NO", ignore.case = FALSE)) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(STE_NAME16 = ifelse(test = Category == "Queensland", yes = "Queensland", no = NA)) %>% 
  tidyr::fill(STE_NAME16) %>% 
  filter(STE_NAME16 == "Queensland") %>% 
  filter(Category != "Hotels, motels and serviced apartments") %>% 
  filter(Category != STE_NAME16) %>% 
  dplyr::mutate(`2015-10` = `GNO_2015-10`/`RNO_2015-10`, 
                `2015-11` = `GNO_2015-11`/`RNO_2015-11`, 
                `2015-12` = `GNO_2015-12`/`RNO_2015-12`) %>% 
  dplyr::select(STE_NAME16, Category, starts_with("20")) %>% 
  gather(`2015-10`:`2015-12`, key = "date", value = "PPR") %>% 
  select(STE_NAME16, date, everything()) %>% 
  arrange(STE_NAME16, date, Category)


Qld_3 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/Qld.xlsx", 
                    sheet = "Table_7", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `RNO_2016-01` = `no.__3`,  `RNO_2016-02` = `no.__4`,  `RNO_2016-03` = `no.__5`, 
                `GNO_2016-01` = `no.__11`, `GNO_2016-02` = `no.__12`, `GNO_2016-03` = `no.__13`) %>% 
  select(Category, contains("NO", ignore.case = FALSE)) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(STE_NAME16 = ifelse(test = Category == "Queensland", yes = "Queensland", no = NA)) %>% 
  tidyr::fill(STE_NAME16) %>% 
  filter(STE_NAME16 == "Queensland") %>% 
  filter(Category != "Hotels, motels and serviced apartments") %>% 
  filter(Category != STE_NAME16) %>% 
  dplyr::mutate(`2016-01` = `GNO_2016-01`/`RNO_2016-01`, 
                `2016-02` = `GNO_2016-02`/`RNO_2016-02`, 
                `2016-03` = `GNO_2016-03`/`RNO_2016-03`) %>% 
  dplyr::select(STE_NAME16, Category, starts_with("20")) %>% 
  gather(`2016-01`:`2016-03`, key = "date", value = "PPR") %>% 
  select(STE_NAME16, date, everything()) %>% 
  arrange(STE_NAME16, date, Category)


Qld_4 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/Qld.xlsx", 
                    sheet = "Table_8", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `RNO_2016-04` = `no.__3`,  `RNO_2016-05` = `no.__4`,  `RNO_2016-06` = `no.__5`, 
                `GNO_2016-04` = `no.__11`, `GNO_2016-05` = `no.__12`, `GNO_2016-06` = `no.__13`) %>% 
  select(Category, contains("NO", ignore.case = FALSE)) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(STE_NAME16 = ifelse(test = Category == "Queensland", yes = "Queensland", no = NA)) %>% 
  tidyr::fill(STE_NAME16) %>% 
  filter(STE_NAME16 == "Queensland") %>% 
  filter(Category != "Hotels, motels and serviced apartments") %>% 
  filter(Category != STE_NAME16) %>% 
  dplyr::mutate(`2016-04` = `GNO_2016-04`/`RNO_2016-04`, 
                `2016-05` = `GNO_2016-05`/`RNO_2016-05`, 
                `2016-06` = `GNO_2016-06`/`RNO_2016-06`) %>% 
  dplyr::select(STE_NAME16, Category, starts_with("20")) %>% 
  gather(`2016-04`:`2016-06`, key = "date", value = "PPR") %>% 
  select(STE_NAME16, date, everything()) %>% 
  arrange(STE_NAME16, date, Category)


Qld <- rbind(Qld_1, Qld_2, Qld_3, Qld_4) %>% 
  mutate(State_short = "QLD") 

rm(Qld_1, Qld_2, Qld_3, Qld_4)


# SA
SA_1 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/SA.xls", 
                   sheet = "Table_6", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `RNO_2015-07` = `no.__3`,  `RNO_2015-08` = `no.__4`,  `RNO_2015-09` = `no.__5`, 
                `GNO_2015-07` = `no.__11`, `GNO_2015-08` = `no.__12`, `GNO_2015-09` = `no.__13`) %>% 
  select(Category, contains("NO", ignore.case = FALSE)) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(STE_NAME16 = ifelse(test = Category == "South Australia", yes = "South Australia", no = NA)) %>% 
  tidyr::fill(STE_NAME16) %>% 
  filter(STE_NAME16 == "South Australia") %>% 
  filter(Category != "Hotels, motels and serviced apartments") %>% 
  filter(Category != STE_NAME16) %>% 
  dplyr::mutate(`2015-07` = `GNO_2015-07`/`RNO_2015-07`, `2015-08` = `GNO_2015-08`/`RNO_2015-08`, `2015-09` = `GNO_2015-09`/`RNO_2015-09`) %>% 
  dplyr::select(STE_NAME16, Category, starts_with("20")) %>% 
  gather(`2015-07`:`2015-09`, key = "date", value = "PPR") %>% 
  select(STE_NAME16, date, everything()) %>% 
  arrange(STE_NAME16, date, Category)


SA_2 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/SA.xls", 
                   sheet = "Table_7", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `RNO_2015-10` = `no.__3`,  `RNO_2015-11` = `no.__4`,  `RNO_2015-12` = `no.__5`, 
                `GNO_2015-10` = `no.__11`, `GNO_2015-11` = `no.__12`, `GNO_2015-12` = `no.__13`) %>% 
  select(Category, contains("NO", ignore.case = FALSE)) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(STE_NAME16 = ifelse(test = Category == "South Australia", yes = "South Australia", no = NA)) %>% 
  tidyr::fill(STE_NAME16) %>% 
  filter(STE_NAME16 == "South Australia") %>% 
  filter(Category != "Hotels, motels and serviced apartments") %>% 
  filter(Category != STE_NAME16) %>% 
  dplyr::mutate(`2015-10` = `GNO_2015-10`/`RNO_2015-10`, 
                `2015-11` = `GNO_2015-11`/`RNO_2015-11`, 
                `2015-12` = `GNO_2015-12`/`RNO_2015-12`) %>% 
  dplyr::select(STE_NAME16, Category, starts_with("20")) %>% 
  gather(`2015-10`:`2015-12`, key = "date", value = "PPR") %>% 
  select(STE_NAME16, date, everything()) %>% 
  arrange(STE_NAME16, date, Category)


SA_3 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/SA.xls", 
                   sheet = "Table_7", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `RNO_2016-01` = `no.__3`,  `RNO_2016-02` = `no.__4`,  `RNO_2016-03` = `no.__5`, 
                `GNO_2016-01` = `no.__11`, `GNO_2016-02` = `no.__12`, `GNO_2016-03` = `no.__13`) %>% 
  select(Category, contains("NO", ignore.case = FALSE)) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(STE_NAME16 = ifelse(test = Category == "South Australia", yes = "South Australia", no = NA)) %>% 
  tidyr::fill(STE_NAME16) %>% 
  filter(STE_NAME16 == "South Australia") %>% 
  filter(Category != "Hotels, motels and serviced apartments") %>% 
  filter(Category != STE_NAME16) %>% 
  dplyr::mutate(`2016-01` = `GNO_2016-01`/`RNO_2016-01`, 
                `2016-02` = `GNO_2016-02`/`RNO_2016-02`, 
                `2016-03` = `GNO_2016-03`/`RNO_2016-03`) %>% 
  dplyr::select(STE_NAME16, Category, starts_with("20")) %>% 
  gather(`2016-01`:`2016-03`, key = "date", value = "PPR") %>% 
  select(STE_NAME16, date, everything()) %>% 
  arrange(STE_NAME16, date, Category)


SA_4 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/SA.xls", 
                   sheet = "Table_8", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `RNO_2016-04` = `no.__3`,  `RNO_2016-05` = `no.__4`,  `RNO_2016-06` = `no.__5`, 
                `GNO_2016-04` = `no.__11`, `GNO_2016-05` = `no.__12`, `GNO_2016-06` = `no.__13`) %>% 
  select(Category, contains("NO", ignore.case = FALSE)) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(STE_NAME16 = ifelse(test = Category == "South Australia", yes = "South Australia", no = NA)) %>% 
  tidyr::fill(STE_NAME16) %>% 
  filter(STE_NAME16 == "South Australia") %>% 
  filter(Category != "Hotels, motels and serviced apartments") %>% 
  filter(Category != STE_NAME16) %>% 
  dplyr::mutate(`2016-04` = `GNO_2016-04`/`RNO_2016-04`, 
                `2016-05` = `GNO_2016-05`/`RNO_2016-05`, 
                `2016-06` = `GNO_2016-06`/`RNO_2016-06`) %>% 
  dplyr::select(STE_NAME16, Category, starts_with("20")) %>% 
  gather(`2016-04`:`2016-06`, key = "date", value = "PPR") %>% 
  select(STE_NAME16, date, everything()) %>% 
  arrange(STE_NAME16, date, Category)


SA <- rbind(SA_1, SA_2, SA_3, SA_4) %>% 
  mutate(State_short = "SA") 

rm(SA_1, SA_2, SA_3, SA_4)


# Tas
# copyright notice has 2017 out of the blue? :/
Tas_1 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/Tas.xls", 
                    sheet = "Table_6", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `RNO_2015-07` = `no.__3`,  `RNO_2015-08` = `no.__4`,  `RNO_2015-09` = `no.__5`, 
                `GNO_2015-07` = `no.__11`, `GNO_2015-08` = `no.__12`, `GNO_2015-09` = `no.__13`) %>% 
  select(Category, contains("NO", ignore.case = FALSE)) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2017") %>% 
  dplyr::mutate(STE_NAME16 = ifelse(test = Category == "Tasmania", yes = "Tasmania", no = NA)) %>% 
  tidyr::fill(STE_NAME16) %>% 
  filter(STE_NAME16 == "Tasmania") %>% 
  filter(Category != "Hotels, motels and serviced apartments") %>% 
  filter(Category != STE_NAME16) %>% 
  dplyr::mutate(`2015-07` = `GNO_2015-07`/`RNO_2015-07`, `2015-08` = `GNO_2015-08`/`RNO_2015-08`, `2015-09` = `GNO_2015-09`/`RNO_2015-09`) %>% 
  dplyr::select(STE_NAME16, Category, starts_with("20")) %>% 
  gather(`2015-07`:`2015-09`, key = "date", value = "PPR") %>% 
  select(STE_NAME16, date, everything()) %>% 
  arrange(STE_NAME16, date, Category)


Tas_2 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/Tas.xls", 
                    sheet = "Table_7", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `RNO_2015-10` = `no.__3`,  `RNO_2015-11` = `no.__4`,  `RNO_2015-12` = `no.__5`, 
                `GNO_2015-10` = `no.__11`, `GNO_2015-11` = `no.__12`, `GNO_2015-12` = `no.__13`) %>% 
  select(Category, contains("NO", ignore.case = FALSE)) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2017") %>% 
  dplyr::mutate(STE_NAME16 = ifelse(test = Category == "Tasmania", yes = "Tasmania", no = NA)) %>% 
  tidyr::fill(STE_NAME16) %>% 
  filter(STE_NAME16 == "Tasmania") %>% 
  filter(Category != "Hotels, motels and serviced apartments") %>% 
  filter(Category != STE_NAME16) %>% 
  dplyr::mutate(`2015-10` = `GNO_2015-10`/`RNO_2015-10`, 
                `2015-11` = `GNO_2015-11`/`RNO_2015-11`, 
                `2015-12` = `GNO_2015-12`/`RNO_2015-12`) %>% 
  dplyr::select(STE_NAME16, Category, starts_with("20")) %>% 
  gather(`2015-10`:`2015-12`, key = "date", value = "PPR") %>% 
  select(STE_NAME16, date, everything()) %>% 
  arrange(STE_NAME16, date, Category)


Tas_3 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/Tas.xls", 
                    sheet = "Table_7", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `RNO_2016-01` = `no.__3`,  `RNO_2016-02` = `no.__4`,  `RNO_2016-03` = `no.__5`, 
                `GNO_2016-01` = `no.__11`, `GNO_2016-02` = `no.__12`, `GNO_2016-03` = `no.__13`) %>% 
  select(Category, contains("NO", ignore.case = FALSE)) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2017") %>% 
  dplyr::mutate(STE_NAME16 = ifelse(test = Category == "Tasmania", yes = "Tasmania", no = NA)) %>% 
  tidyr::fill(STE_NAME16) %>% 
  filter(STE_NAME16 == "Tasmania") %>% 
  filter(Category != "Hotels, motels and serviced apartments") %>% 
  filter(Category != STE_NAME16) %>% 
  dplyr::mutate(`2016-01` = `GNO_2016-01`/`RNO_2016-01`, 
                `2016-02` = `GNO_2016-02`/`RNO_2016-02`, 
                `2016-03` = `GNO_2016-03`/`RNO_2016-03`) %>% 
  dplyr::select(STE_NAME16, Category, starts_with("20")) %>% 
  gather(`2016-01`:`2016-03`, key = "date", value = "PPR") %>% 
  select(STE_NAME16, date, everything()) %>% 
  arrange(STE_NAME16, date, Category)


Tas_4 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/Tas.xls", 
                    sheet = "Table_8", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `RNO_2016-04` = `no.__3`,  `RNO_2016-05` = `no.__4`,  `RNO_2016-06` = `no.__5`, 
                `GNO_2016-04` = `no.__11`, `GNO_2016-05` = `no.__12`, `GNO_2016-06` = `no.__13`) %>% 
  select(Category, contains("NO", ignore.case = FALSE)) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2017") %>% 
  dplyr::mutate(STE_NAME16 = ifelse(test = Category == "Tasmania", yes = "Tasmania", no = NA)) %>% 
  tidyr::fill(STE_NAME16) %>% 
  filter(STE_NAME16 == "Tasmania") %>% 
  filter(Category != "Hotels, motels and serviced apartments") %>% 
  filter(Category != STE_NAME16) %>% 
  dplyr::mutate(`2016-04` = `GNO_2016-04`/`RNO_2016-04`, 
                `2016-05` = `GNO_2016-05`/`RNO_2016-05`, 
                `2016-06` = `GNO_2016-06`/`RNO_2016-06`) %>% 
  dplyr::select(STE_NAME16, Category, starts_with("20")) %>% 
  gather(`2016-04`:`2016-06`, key = "date", value = "PPR") %>% 
  select(STE_NAME16, date, everything()) %>% 
  arrange(STE_NAME16, date, Category)


Tas <- rbind(Tas_1, Tas_2, Tas_3, Tas_4) %>% 
  mutate(State_short = "TAS") 

rm(Tas_1, Tas_2, Tas_3, Tas_4)


# Vic
# copyright notice has 2017 out of the blue? :/
Vic_1 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/Vic.xlsx", 
                    sheet = "Table_6", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `RNO_2015-07` = `no.__3`,  `RNO_2015-08` = `no.__4`,  `RNO_2015-09` = `no.__5`, 
                `GNO_2015-07` = `no.__11`, `GNO_2015-08` = `no.__12`, `GNO_2015-09` = `no.__13`) %>% 
  select(Category, contains("NO", ignore.case = FALSE)) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(STE_NAME16 = ifelse(test = Category == "Victoria", yes = "Victoria", no = NA)) %>% 
  tidyr::fill(STE_NAME16) %>% 
  filter(STE_NAME16 == "Victoria") %>% 
  filter(Category != "Hotels, motels and serviced apartments") %>% 
  filter(Category != STE_NAME16) %>% 
  dplyr::mutate(`2015-07` = `GNO_2015-07`/`RNO_2015-07`, `2015-08` = `GNO_2015-08`/`RNO_2015-08`, `2015-09` = `GNO_2015-09`/`RNO_2015-09`) %>% 
  dplyr::select(STE_NAME16, Category, starts_with("20")) %>% 
  gather(`2015-07`:`2015-09`, key = "date", value = "PPR") %>% 
  select(STE_NAME16, date, everything()) %>% 
  arrange(STE_NAME16, date, Category)


Vic_2 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/Vic.xlsx", 
                    sheet = "Table_7", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `RNO_2015-10` = `no.__3`,  `RNO_2015-11` = `no.__4`,  `RNO_2015-12` = `no.__5`, 
                `GNO_2015-10` = `no.__11`, `GNO_2015-11` = `no.__12`, `GNO_2015-12` = `no.__13`) %>% 
  select(Category, contains("NO", ignore.case = FALSE)) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(STE_NAME16 = ifelse(test = Category == "Victoria", yes = "Victoria", no = NA)) %>% 
  tidyr::fill(STE_NAME16) %>% 
  filter(STE_NAME16 == "Victoria") %>% 
  filter(Category != "Hotels, motels and serviced apartments") %>% 
  filter(Category != STE_NAME16) %>% 
  dplyr::mutate(`2015-10` = `GNO_2015-10`/`RNO_2015-10`, 
                `2015-11` = `GNO_2015-11`/`RNO_2015-11`, 
                `2015-12` = `GNO_2015-12`/`RNO_2015-12`) %>% 
  dplyr::select(STE_NAME16, Category, starts_with("20")) %>% 
  gather(`2015-10`:`2015-12`, key = "date", value = "PPR") %>% 
  select(STE_NAME16, date, everything()) %>% 
  arrange(STE_NAME16, date, Category)


Vic_3 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/Vic.xlsx", 
                    sheet = "Table_7", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `RNO_2016-01` = `no.__3`,  `RNO_2016-02` = `no.__4`,  `RNO_2016-03` = `no.__5`, 
                `GNO_2016-01` = `no.__11`, `GNO_2016-02` = `no.__12`, `GNO_2016-03` = `no.__13`) %>% 
  select(Category, contains("NO", ignore.case = FALSE)) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(STE_NAME16 = ifelse(test = Category == "Victoria", yes = "Victoria", no = NA)) %>% 
  tidyr::fill(STE_NAME16) %>% 
  filter(STE_NAME16 == "Victoria") %>% 
  filter(Category != "Hotels, motels and serviced apartments") %>% 
  filter(Category != STE_NAME16) %>% 
  dplyr::mutate(`2016-01` = `GNO_2016-01`/`RNO_2016-01`, 
                `2016-02` = `GNO_2016-02`/`RNO_2016-02`, 
                `2016-03` = `GNO_2016-03`/`RNO_2016-03`) %>% 
  dplyr::select(STE_NAME16, Category, starts_with("20")) %>% 
  gather(`2016-01`:`2016-03`, key = "date", value = "PPR") %>% 
  select(STE_NAME16, date, everything()) %>% 
  arrange(STE_NAME16, date, Category)


Vic_4 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/Vic.xlsx", 
                    sheet = "Table_8", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `RNO_2016-04` = `no.__3`,  `RNO_2016-05` = `no.__4`,  `RNO_2016-06` = `no.__5`, 
                `GNO_2016-04` = `no.__11`, `GNO_2016-05` = `no.__12`, `GNO_2016-06` = `no.__13`) %>% 
  select(Category, contains("NO", ignore.case = FALSE)) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(STE_NAME16 = ifelse(test = Category == "Victoria", yes = "Victoria", no = NA)) %>% 
  tidyr::fill(STE_NAME16) %>% 
  filter(STE_NAME16 == "Victoria") %>% 
  filter(Category != "Hotels, motels and serviced apartments") %>% 
  filter(Category != STE_NAME16) %>% 
  dplyr::mutate(`2016-04` = `GNO_2016-04`/`RNO_2016-04`, 
                `2016-05` = `GNO_2016-05`/`RNO_2016-05`, 
                `2016-06` = `GNO_2016-06`/`RNO_2016-06`) %>% 
  dplyr::select(STE_NAME16, Category, starts_with("20")) %>% 
  gather(`2016-04`:`2016-06`, key = "date", value = "PPR") %>% 
  select(STE_NAME16, date, everything()) %>% 
  arrange(STE_NAME16, date, Category)


Vic <- rbind(Vic_1, Vic_2, Vic_3, Vic_4) %>% 
  mutate(State_short = "VIC") 

rm(Vic_1, Vic_2, Vic_3, Vic_4)


# WA
# copyright notice has 2017 out of the blue? :/
WA_1 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/WA.xls", 
                   sheet = "Table_6", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `RNO_2015-07` = `no.__3`,  `RNO_2015-08` = `no.__4`,  `RNO_2015-09` = `no.__5`, 
                `GNO_2015-07` = `no.__11`, `GNO_2015-08` = `no.__12`, `GNO_2015-09` = `no.__13`) %>% 
  select(Category, contains("NO", ignore.case = FALSE)) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(STE_NAME16 = ifelse(test = Category == "Western Australia", yes = "Western Australia", no = NA)) %>% 
  tidyr::fill(STE_NAME16) %>% 
  filter(STE_NAME16 == "Western Australia") %>% 
  filter(Category != "Hotels, motels and serviced apartments") %>% 
  filter(Category != STE_NAME16) %>% 
  dplyr::mutate(`2015-07` = `GNO_2015-07`/`RNO_2015-07`, `2015-08` = `GNO_2015-08`/`RNO_2015-08`, `2015-09` = `GNO_2015-09`/`RNO_2015-09`) %>% 
  dplyr::select(STE_NAME16, Category, starts_with("20")) %>% 
  gather(`2015-07`:`2015-09`, key = "date", value = "PPR") %>% 
  select(STE_NAME16, date, everything()) %>% 
  arrange(STE_NAME16, date, Category)


WA_2 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/WA.xls", 
                   sheet = "Table_7", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `RNO_2015-10` = `no.__3`,  `RNO_2015-11` = `no.__4`,  `RNO_2015-12` = `no.__5`, 
                `GNO_2015-10` = `no.__11`, `GNO_2015-11` = `no.__12`, `GNO_2015-12` = `no.__13`) %>% 
  select(Category, contains("NO", ignore.case = FALSE)) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(STE_NAME16 = ifelse(test = Category == "Western Australia", yes = "Western Australia", no = NA)) %>% 
  tidyr::fill(STE_NAME16) %>% 
  filter(STE_NAME16 == "Western Australia") %>% 
  filter(Category != "Hotels, motels and serviced apartments") %>% 
  filter(Category != STE_NAME16) %>% 
  dplyr::mutate(`2015-10` = `GNO_2015-10`/`RNO_2015-10`, 
                `2015-11` = `GNO_2015-11`/`RNO_2015-11`, 
                `2015-12` = `GNO_2015-12`/`RNO_2015-12`) %>% 
  dplyr::select(STE_NAME16, Category, starts_with("20")) %>% 
  gather(`2015-10`:`2015-12`, key = "date", value = "PPR") %>% 
  select(STE_NAME16, date, everything()) %>% 
  arrange(STE_NAME16, date, Category)


WA_3 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/WA.xls", 
                   sheet = "Table_7", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `RNO_2016-01` = `no.__3`,  `RNO_2016-02` = `no.__4`,  `RNO_2016-03` = `no.__5`, 
                `GNO_2016-01` = `no.__11`, `GNO_2016-02` = `no.__12`, `GNO_2016-03` = `no.__13`) %>% 
  select(Category, contains("NO", ignore.case = FALSE)) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(STE_NAME16 = ifelse(test = Category == "Western Australia", yes = "Western Australia", no = NA)) %>% 
  tidyr::fill(STE_NAME16) %>% 
  filter(STE_NAME16 == "Western Australia") %>% 
  filter(Category != "Hotels, motels and serviced apartments") %>% 
  filter(Category != STE_NAME16) %>% 
  dplyr::mutate(`2016-01` = `GNO_2016-01`/`RNO_2016-01`, 
                `2016-02` = `GNO_2016-02`/`RNO_2016-02`, 
                `2016-03` = `GNO_2016-03`/`RNO_2016-03`) %>% 
  dplyr::select(STE_NAME16, Category, starts_with("20")) %>% 
  gather(`2016-01`:`2016-03`, key = "date", value = "PPR") %>% 
  select(STE_NAME16, date, everything()) %>% 
  arrange(STE_NAME16, date, Category)


WA_4 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/WA.xls", 
                   sheet = "Table_8", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `RNO_2016-04` = `no.__3`,  `RNO_2016-05` = `no.__4`,  `RNO_2016-06` = `no.__5`, 
                `GNO_2016-04` = `no.__11`, `GNO_2016-05` = `no.__12`, `GNO_2016-06` = `no.__13`) %>% 
  select(Category, contains("NO", ignore.case = FALSE)) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(STE_NAME16 = ifelse(test = Category == "Western Australia", yes = "Western Australia", no = NA)) %>% 
  tidyr::fill(STE_NAME16) %>% 
  filter(STE_NAME16 == "Western Australia") %>% 
  filter(Category != "Hotels, motels and serviced apartments") %>% 
  filter(Category != STE_NAME16) %>% 
  dplyr::mutate(`2016-04` = `GNO_2016-04`/`RNO_2016-04`, 
                `2016-05` = `GNO_2016-05`/`RNO_2016-05`, 
                `2016-06` = `GNO_2016-06`/`RNO_2016-06`) %>% 
  dplyr::select(STE_NAME16, Category, starts_with("20")) %>% 
  gather(`2016-04`:`2016-06`, key = "date", value = "PPR") %>% 
  select(STE_NAME16, date, everything()) %>% 
  arrange(STE_NAME16, date, Category)


WA <- rbind(WA_1, WA_2, WA_3, WA_4) %>% 
  mutate(State_short = "WA") 

rm(WA_1, WA_2, WA_3, WA_4)


# All
TA_STA_PPR_15_16 <- rbind(ACT, NSW, NT, Qld, SA, Tas, Vic, WA) 

rm(ACT, NSW, NT, Qld, SA, Tas, Vic, WA) 

# table(TA_STA_PPR_15_16$date)
# table(TA_STA_PPR_15_16$State_short)

saveRDS(TA_STA_PPR_15_16, file = "./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/clean/TA_STA_PPR_15_16.rds")
write_csv(TA_STA_PPR_15_16, "./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/clean/TA_STA_PPR_15_16.csv")
```


## TR level data - detailed

- Monthly values of **Guest Nights Occupied** (GNO) were extracted
- **Values are extracted per subcategory of accomodation (`Hotels and resorts`, `Motels, private hotels and guest houses`, `Serviced apartments`) and these figures will vary from totals per region when overall count of `Hotels, motels and serviced apartments` is used!**
- **Empty** cells are kept as missing data to differentiate fromlegitimate 0s.
- **Date** is formated as text
- Data are linked to spatial boundaries - unfortunately **2015 TRs** are used :/


```{r, include=FALSE}
# ACT
ACT_1 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/ACT.xls", 
                    sheet = "Table_2", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2015-07` = `no.__11`, `2015-08` = `no.__12`, `2015-09` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "Total Accommodation", yes = "Canberra", no = NA)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(TR_CODE15 == "Canberra") %>% 
  filter(Category != "Total Accommodation") %>% 
  filter(Category != "Hotels, motels and serviced apartments") %>% 
  gather(`2015-07`:`2015-09`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category)

ACT_2 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/ACT.xls", 
                    sheet = "Table_3", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2015-10` = `no.__11`, `2015-11` = `no.__12`, `2015-12` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "Total Accommodation", yes = "Canberra", no = NA)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(TR_CODE15 == "Canberra") %>% 
  filter(Category != "Total Accommodation") %>% 
  filter(Category != "Hotels, motels and serviced apartments") %>% 
  gather(`2015-10`:`2015-12`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category) 

ACT_3 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/ACT.xls", 
                    sheet = "Table_4", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2016-01` = `no.__11`, `2016-02` = `no.__12`, `2016-03` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "Total Accommodation", yes = "Canberra", no = NA)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(TR_CODE15 == "Canberra") %>% 
  filter(Category != "Total Accommodation") %>% 
  filter(Category != "Hotels, motels and serviced apartments") %>% 
  gather(`2016-01`:`2016-03`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category) 

ACT_4 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/ACT.xls", 
                    sheet = "Table_5", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2016-04` = `no.__11`, `2016-05` = `no.__12`, `2016-06` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "Total Accommodation", yes = "Canberra", no = NA)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(TR_CODE15 == "Canberra") %>% 
  filter(Category != "Total Accommodation") %>% 
  filter(Category != "Hotels, motels and serviced apartments") %>% 
  gather(`2016-04`:`2016-06`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category)

ACT <- rbind(ACT_1, ACT_2, ACT_3, ACT_4) %>% 
  mutate(State_short = "ACT") %>% 
  mutate(State_long = "Australian Capital Territory")

rm(ACT_1, ACT_2, ACT_3, ACT_4)


# NSW
# for some bizzare reason original xsl file was not able to open in R despite working in excell
# file was saved as xslx without any modifications ant now it works - beats me o_O
NSW_1 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/NSW.xlsx", 
                    sheet = "Table_6", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2015-07` = `no.__11`, `2015-08` = `no.__12`, `2015-09` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = grepl("(TR)", Category), yes = Category, no = NA)) %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "New South Wales", yes = "New South Wales", no = TR_CODE15)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(Category != TR_CODE15) %>% 
  filter(TR_CODE15 != "New South Wales") %>% 
  filter(Category != "Hotels, motels and serviced apartments") %>% 
  gather(`2015-07`:`2015-09`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category)

NSW_2 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/NSW.xlsx", 
                    sheet = "Table_7", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2015-10` = `no.__11`, `2015-11` = `no.__12`, `2015-12` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = grepl("(TR)", Category), yes = Category, no = NA)) %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "New South Wales", yes = "New South Wales", no = TR_CODE15)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(Category != TR_CODE15) %>% 
  filter(TR_CODE15 != "New South Wales") %>% 
  filter(Category != "Hotels, motels and serviced apartments") %>% 
  gather(`2015-10`:`2015-12`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category)

NSW_3 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/NSW.xlsx", 
                    sheet = "Table_8", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2016-01` = `no.__11`, `2016-02` = `no.__12`, `2016-03` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = grepl("(TR)", Category), yes = Category, no = NA)) %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "New South Wales", yes = "New South Wales", no = TR_CODE15)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(Category != TR_CODE15) %>% 
  filter(TR_CODE15 != "New South Wales") %>% 
  filter(Category != "Hotels, motels and serviced apartments") %>% 
  gather(`2016-01`:`2016-03`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category)

NSW_4 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/NSW.xlsx", 
                    sheet = "Table_9", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2016-04` = `no.__11`, `2016-05` = `no.__12`, `2016-06` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = grepl("(TR)", Category), yes = Category, no = NA)) %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "New South Wales", yes = "New South Wales", no = TR_CODE15)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(Category != TR_CODE15) %>% 
  filter(TR_CODE15 != "New South Wales") %>% 
  filter(Category != "Hotels, motels and serviced apartments") %>% 
  gather(`2016-04`:`2016-06`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category)

NSW <- rbind(NSW_1, NSW_2, NSW_3, NSW_4) %>% 
  mutate(State_short = "NSW") %>% 
  mutate(State_long = "New South Wales")

rm(NSW_1, NSW_2, NSW_3, NSW_4)


# NT
NT_1 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/NT.xls", 
                   sheet = "Table_6", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2015-07` = `no.__11`, `2015-08` = `no.__12`, `2015-09` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = grepl("(TR)", Category), yes = Category, no = NA)) %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "Northern Territory", yes = "Northern Territory", no = TR_CODE15)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(Category != TR_CODE15) %>% 
  filter(TR_CODE15 != "Northern Territory") %>% 
  filter(Category != "Hotels, motels and serviced apartments") %>% 
  gather(`2015-07`:`2015-09`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category) 

NT_2 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/NT.xls", 
                   sheet = "Table_7", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2015-10` = `no.__11`, `2015-11` = `no.__12`, `2015-12` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = grepl("(TR)", Category), yes = Category, no = NA)) %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "Northern Territory", yes = "Northern Territory", no = TR_CODE15)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(Category != TR_CODE15) %>% 
  filter(TR_CODE15 != "Northern Territory") %>% 
  filter(Category != "Hotels, motels and serviced apartments") %>% 
  gather(`2015-10`:`2015-12`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category)

NT_3 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/NT.xls", 
                   sheet = "Table_8", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2016-01` = `no.__11`, `2016-02` = `no.__12`, `2016-03` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = grepl("(TR)", Category), yes = Category, no = NA)) %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "Northern Territory", yes = "Northern Territory", no = TR_CODE15)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(Category != TR_CODE15) %>% 
  filter(TR_CODE15 != "Northern Territory") %>% 
  filter(Category != "Hotels, motels and serviced apartments") %>% 
  gather(`2016-01`:`2016-03`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category)

NT_4 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/NT.xls", 
                   sheet = "Table_9", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2016-04` = `no.__11`, `2016-05` = `no.__12`, `2016-06` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = grepl("(TR)", Category), yes = Category, no = NA)) %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "Northern Territory", yes = "Northern Territory", no = TR_CODE15)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(Category != TR_CODE15) %>% 
  filter(TR_CODE15 != "Northern Territory") %>% 
  filter(Category != "Hotels, motels and serviced apartments") %>% 
  gather(`2016-04`:`2016-06`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category)

NT <- rbind(NT_1, NT_2, NT_3, NT_4) %>% 
  mutate(State_short = "NT") %>% 
  mutate(State_long = "Northern Territory")

rm(NT_1, NT_2, NT_3, NT_4)


# Qld
Qld_1 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/Qld.xlsx", 
                    sheet = "Table_6", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2015-07` = `no.__11`, `2015-08` = `no.__12`, `2015-09` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = grepl("(TR)", Category), yes = Category, no = NA)) %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "Queensland", yes = "Queensland", no = TR_CODE15)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(Category != TR_CODE15) %>% 
  filter(TR_CODE15 != "Queensland") %>% 
  filter(Category != "Hotels, motels and serviced apartments") %>% 
  gather(`2015-07`:`2015-09`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category) 

Qld_2 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/Qld.xlsx", 
                    sheet = "Table_7", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2015-10` = `no.__11`, `2015-11` = `no.__12`, `2015-12` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = grepl("(TR)", Category), yes = Category, no = NA)) %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "Queensland", yes = "Queensland", no = TR_CODE15)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(Category != TR_CODE15) %>% 
  filter(TR_CODE15 != "Queensland") %>% 
  filter(Category != "Hotels, motels and serviced apartments") %>% 
  gather(`2015-10`:`2015-12`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category) 

Qld_3 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/Qld.xlsx", 
                    sheet = "Table_8", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2016-01` = `no.__11`, `2016-02` = `no.__12`, `2016-03` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = grepl("(TR)", Category), yes = Category, no = NA)) %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "Queensland", yes = "Queensland", no = TR_CODE15)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(Category != TR_CODE15) %>% 
  filter(TR_CODE15 != "Queensland") %>% 
  filter(Category != "Hotels, motels and serviced apartments") %>% 
  gather(`2016-01`:`2016-03`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category)

Qld_4 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/Qld.xlsx", 
                    sheet = "Table_9", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2016-04` = `no.__11`, `2016-05` = `no.__12`, `2016-06` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = grepl("(TR)", Category), yes = Category, no = NA)) %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "Queensland", yes = "Queensland", no = TR_CODE15)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(Category != TR_CODE15) %>% 
  filter(TR_CODE15 != "Queensland") %>% 
  filter(Category != "Hotels, motels and serviced apartments") %>% 
  gather(`2016-04`:`2016-06`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category)

Qld <- rbind(Qld_1, Qld_2, Qld_3, Qld_4) %>% 
  mutate(State_short = "Qld") %>% 
  mutate(State_long = "Queensland")

rm(Qld_1, Qld_2, Qld_3, Qld_4)


# SA
SA_1 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/SA.xls", 
                   sheet = "Table_6", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2015-07` = `no.__11`, `2015-08` = `no.__12`, `2015-09` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = grepl("(TR)", Category), yes = Category, no = NA)) %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "South Australia", yes = "South Australia", no = TR_CODE15)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(Category != TR_CODE15) %>% 
  filter(TR_CODE15 != "South Australia") %>% 
  filter(Category != "Hotels, motels and serviced apartments") %>% 
  gather(`2015-07`:`2015-09`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category) 

SA_2 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/SA.xls", 
                   sheet = "Table_7", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2015-10` = `no.__11`, `2015-11` = `no.__12`, `2015-12` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = grepl("(TR)", Category), yes = Category, no = NA)) %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "South Australia", yes = "South Australia", no = TR_CODE15)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(Category != TR_CODE15) %>% 
  filter(TR_CODE15 != "South Australia") %>% 
  filter(Category != "Hotels, motels and serviced apartments") %>% 
  gather(`2015-10`:`2015-12`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category)

SA_3 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/SA.xls", 
                   sheet = "Table_8", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2016-01` = `no.__11`, `2016-02` = `no.__12`, `2016-03` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = grepl("(TR)", Category), yes = Category, no = NA)) %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "South Australia", yes = "South Australia", no = TR_CODE15)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(Category != TR_CODE15) %>% 
  filter(TR_CODE15 != "South Australia") %>% 
  filter(Category != "Hotels, motels and serviced apartments") %>% 
  gather(`2016-01`:`2016-03`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category)

SA_4 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/SA.xls", 
                   sheet = "Table_9", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2016-04` = `no.__11`, `2016-05` = `no.__12`, `2016-06` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = grepl("(TR)", Category), yes = Category, no = NA)) %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "South Australia", yes = "South Australia", no = TR_CODE15)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(Category != TR_CODE15) %>% 
  filter(TR_CODE15 != "South Australia") %>% 
  filter(Category != "Hotels, motels and serviced apartments") %>% 
  gather(`2016-04`:`2016-06`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category)

SA <- rbind(SA_1, SA_2, SA_3, SA_4) %>% 
  mutate(State_short = "SA") %>% 
  mutate(State_long = "South Australia")

rm(SA_1, SA_2, SA_3, SA_4)


# Tas
Tas_1 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/Tas.xls", 
                    sheet = "Table_6", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2015-07` = `no.__11`, `2015-08` = `no.__12`, `2015-09` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2017") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = grepl("(TR)", Category), yes = Category, no = NA)) %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "Tasmania", yes = "Tasmania", no = TR_CODE15)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(Category != TR_CODE15) %>% 
  filter(TR_CODE15 != "Tasmania") %>% 
  filter(Category != "Hotels, motels and serviced apartments") %>% 
  gather(`2015-07`:`2015-09`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category)

Tas_2 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/Tas.xls", 
                    sheet = "Table_7", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2015-10` = `no.__11`, `2015-11` = `no.__12`, `2015-12` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2017") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = grepl("(TR)", Category), yes = Category, no = NA)) %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "Tasmania", yes = "Tasmania", no = TR_CODE15)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(Category != TR_CODE15) %>% 
  filter(TR_CODE15 != "Tasmania") %>% 
  filter(Category != "Hotels, motels and serviced apartments") %>% 
  gather(`2015-10`:`2015-12`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category)

Tas_3 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/Tas.xls", 
                    sheet = "Table_8", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2016-01` = `no.__11`, `2016-02` = `no.__12`, `2016-03` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2017") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = grepl("(TR)", Category), yes = Category, no = NA)) %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "Tasmania", yes = "Tasmania", no = TR_CODE15)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(Category != TR_CODE15) %>% 
  filter(TR_CODE15 != "Tasmania") %>% 
  filter(Category != "Hotels, motels and serviced apartments") %>% 
  gather(`2016-01`:`2016-03`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category)

Tas_4 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/Tas.xls", 
                    sheet = "Table_9", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2016-04` = `no.__11`, `2016-05` = `no.__12`, `2016-06` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2017") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = grepl("(TR)", Category), yes = Category, no = NA)) %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "Tasmania", yes = "Tasmania", no = TR_CODE15)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(Category != TR_CODE15) %>% 
  filter(TR_CODE15 != "Tasmania") %>% 
  filter(Category != "Hotels, motels and serviced apartments") %>% 
  gather(`2016-04`:`2016-06`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category)

Tas <- rbind(Tas_1, Tas_2, Tas_3, Tas_4) %>% 
  mutate(State_short = "Tas") %>% 
  mutate(State_long = "Tasmania")

rm(Tas_1, Tas_2, Tas_3, Tas_4)


# Vic
Vic_1 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/Vic.xlsx", 
                    sheet = "Table_6", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2015-07` = `no.__11`, `2015-08` = `no.__12`, `2015-09` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = grepl("(TR)", Category), yes = Category, no = NA)) %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "Victoria", yes = "Victoria", no = TR_CODE15)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(Category != TR_CODE15) %>% 
  filter(TR_CODE15 != "Victoria") %>% 
  filter(Category != "Hotels, motels and serviced apartments") %>% 
  gather(`2015-07`:`2015-09`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category)

Vic_2 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/Vic.xlsx", 
                    sheet = "Table_7", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2015-10` = `no.__11`, `2015-11` = `no.__12`, `2015-12` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = grepl("(TR)", Category), yes = Category, no = NA)) %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "Victoria", yes = "Victoria", no = TR_CODE15)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(Category != TR_CODE15) %>% 
  filter(TR_CODE15 != "Victoria") %>% 
  filter(Category != "Hotels, motels and serviced apartments") %>% 
  gather(`2015-10`:`2015-12`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category)

Vic_3 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/Vic.xlsx", 
                    sheet = "Table_8", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2016-01` = `no.__11`, `2016-02` = `no.__12`, `2016-03` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = grepl("(TR)", Category), yes = Category, no = NA)) %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "Victoria", yes = "Victoria", no = TR_CODE15)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(Category != TR_CODE15) %>% 
  filter(TR_CODE15 != "Victoria") %>% 
  filter(Category != "Hotels, motels and serviced apartments") %>% 
  gather(`2016-01`:`2016-03`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category)

Vic_4 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/Vic.xlsx", 
                    sheet = "Table_9", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2016-04` = `no.__11`, `2016-05` = `no.__12`, `2016-06` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = grepl("(TR)", Category), yes = Category, no = NA)) %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "Victoria", yes = "Victoria", no = TR_CODE15)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(Category != TR_CODE15) %>% 
  filter(TR_CODE15 != "Victoria") %>% 
  filter(Category != "Hotels, motels and serviced apartments") %>% 
  gather(`2016-04`:`2016-06`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category)

Vic <- rbind(Vic_1, Vic_2, Vic_3, Vic_4) %>% 
  mutate(State_short = "Vic") %>% 
  mutate(State_long = "Victoria")

rm(Vic_1, Vic_2, Vic_3, Vic_4)


# WA
WA_1 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/WA.xls", 
                   sheet = "Table_6", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2015-07` = `no.__11`, `2015-08` = `no.__12`, `2015-09` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = grepl("(TR)", Category), yes = Category, no = NA)) %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "Western Australia", yes = "Western Australia", no = TR_CODE15)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(Category != TR_CODE15) %>% 
  filter(TR_CODE15 != "Western Australia") %>% 
  filter(Category != "Hotels, motels and serviced apartments") %>% 
  gather(`2015-07`:`2015-09`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category)

WA_2 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/WA.xls", 
                   sheet = "Table_7", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2015-10` = `no.__11`, `2015-11` = `no.__12`, `2015-12` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = grepl("(TR)", Category), yes = Category, no = NA)) %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "Western Australia", yes = "Western Australia", no = TR_CODE15)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(Category != TR_CODE15) %>% 
  filter(TR_CODE15 != "Western Australia") %>% 
  filter(Category != "Hotels, motels and serviced apartments") %>% 
  gather(`2015-10`:`2015-12`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category)

WA_3 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/WA.xls", 
                   sheet = "Table_8", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2016-01` = `no.__11`, `2016-02` = `no.__12`, `2016-03` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = grepl("(TR)", Category), yes = Category, no = NA)) %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "Western Australia", yes = "Western Australia", no = TR_CODE15)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(Category != TR_CODE15) %>% 
  filter(TR_CODE15 != "Western Australia") %>% 
  filter(Category != "Hotels, motels and serviced apartments") %>% 
  gather(`2016-01`:`2016-03`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category) 

WA_4 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/WA.xls", 
                   sheet = "Table_9", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2016-04` = `no.__11`, `2016-05` = `no.__12`, `2016-06` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = grepl("(TR)", Category), yes = Category, no = NA)) %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "Western Australia", yes = "Western Australia", no = TR_CODE15)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(Category != TR_CODE15) %>% 
  filter(TR_CODE15 != "Western Australia") %>% 
  filter(Category != "Hotels, motels and serviced apartments") %>% 
  gather(`2016-04`:`2016-06`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category)

WA <- rbind(WA_1, WA_2, WA_3, WA_4) %>% 
  mutate(State_short = "WA") %>% 
  mutate(State_long = "Western Australia")

rm(WA_1, WA_2, WA_3, WA_4)

# All
TA_TR_GNO_15_16 <- rbind(ACT, NSW, NT, Qld, SA, Tas, Vic, WA) %>% 
  mutate(TR_CODE15 = str_replace(TR_CODE15, coll(" (TR)"), ""))

rm(ACT, NSW, NT, Qld, SA, Tas, Vic, WA) 

# table(TA_TR_GNO_15_16$date)
# table(TA_TR_GNO_15_16$TR_CODE15)
```


## TR level data - aggregated

- Monthly values of **Guest Nights Occupied** (GNO) were extracted
- **Values are extracted for all types of accomodation together,(ie. `Hotels, motels and serviced apartments` category)!**
- **Empty** cells are kept as missing data to differentiate fromlegitimate 0s.
- **Date** is formated as text
- Data are linked to spatial boundaries - unfortunately **2015 TRs** are used :/


```{r, include=FALSE}
# ACT
ACT_1 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/ACT.xls", 
                    sheet = "Table_2", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2015-07` = `no.__11`, `2015-08` = `no.__12`, `2015-09` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "Total Accommodation", yes = "Canberra", no = NA)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(Category != TR_CODE15) %>% 
  filter(Category != "Total Accommodation") %>% 
  filter(TR_CODE15 == "Canberra") %>% 
  filter(Category == "Hotels, motels and serviced apartments") %>% 
  gather(`2015-07`:`2015-09`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category)

ACT_2 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/ACT.xls", 
                    sheet = "Table_3", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2015-10` = `no.__11`, `2015-11` = `no.__12`, `2015-12` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "Total Accommodation", yes = "Canberra", no = NA)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(Category != TR_CODE15) %>% 
  filter(Category != "Total Accommodation") %>% 
  filter(TR_CODE15 == "Canberra") %>% 
  filter(Category == "Hotels, motels and serviced apartments") %>% 
  gather(`2015-10`:`2015-12`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category) 

ACT_3 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/ACT.xls", 
                    sheet = "Table_4", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2016-01` = `no.__11`, `2016-02` = `no.__12`, `2016-03` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "Total Accommodation", yes = "Canberra", no = NA)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(Category != TR_CODE15) %>% 
  filter(Category != "Total Accommodation") %>% 
  filter(TR_CODE15 == "Canberra") %>% 
  filter(Category == "Hotels, motels and serviced apartments") %>% 
  gather(`2016-01`:`2016-03`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category) 

ACT_4 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/ACT.xls", 
                    sheet = "Table_5", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2016-04` = `no.__11`, `2016-05` = `no.__12`, `2016-06` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "Total Accommodation", yes = "Canberra", no = NA)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(Category != TR_CODE15) %>% 
  filter(Category != "Total Accommodation") %>% 
  filter(TR_CODE15 == "Canberra") %>% 
  filter(Category == "Hotels, motels and serviced apartments") %>% 
  gather(`2016-04`:`2016-06`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category)

ACT <- rbind(ACT_1, ACT_2, ACT_3, ACT_4) %>% 
  mutate(State_short = "ACT") %>% 
  mutate(State_long = "Australian Capital Territory")

rm(ACT_1, ACT_2, ACT_3, ACT_4)


# NSW
# for some bizzare reason original xsl file was not able to open in R despite working in excell
# file was saved as xslx without any modifications ant now it works - beats me o_O
NSW_1 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/NSW.xlsx", 
                    sheet = "Table_6", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2015-07` = `no.__11`, `2015-08` = `no.__12`, `2015-09` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = grepl("(TR)", Category), yes = Category, no = NA)) %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "New South Wales", yes = "New South Wales", no = TR_CODE15)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(Category != TR_CODE15) %>% 
  filter(TR_CODE15 != "New South Wales") %>% 
  filter(Category == "Hotels, motels and serviced apartments") %>% 
  gather(`2015-07`:`2015-09`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category)

NSW_2 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/NSW.xlsx", 
                    sheet = "Table_7", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2015-10` = `no.__11`, `2015-11` = `no.__12`, `2015-12` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = grepl("(TR)", Category), yes = Category, no = NA)) %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "New South Wales", yes = "New South Wales", no = TR_CODE15)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(Category != TR_CODE15) %>% 
  filter(TR_CODE15 != "New South Wales") %>% 
  filter(Category == "Hotels, motels and serviced apartments") %>% 
  gather(`2015-10`:`2015-12`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category)

NSW_3 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/NSW.xlsx", 
                    sheet = "Table_8", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2016-01` = `no.__11`, `2016-02` = `no.__12`, `2016-03` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = grepl("(TR)", Category), yes = Category, no = NA)) %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "New South Wales", yes = "New South Wales", no = TR_CODE15)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(Category != TR_CODE15) %>% 
  filter(TR_CODE15 != "New South Wales") %>% 
  filter(Category == "Hotels, motels and serviced apartments") %>% 
  gather(`2016-01`:`2016-03`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category)

NSW_4 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/NSW.xlsx", 
                    sheet = "Table_9", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2016-04` = `no.__11`, `2016-05` = `no.__12`, `2016-06` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = grepl("(TR)", Category), yes = Category, no = NA)) %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "New South Wales", yes = "New South Wales", no = TR_CODE15)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(Category != TR_CODE15) %>% 
  filter(TR_CODE15 != "New South Wales") %>% 
  filter(Category == "Hotels, motels and serviced apartments") %>% 
  gather(`2016-04`:`2016-06`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category)

NSW <- rbind(NSW_1, NSW_2, NSW_3, NSW_4) %>% 
  mutate(State_short = "NSW") %>% 
  mutate(State_long = "New South Wales")

rm(NSW_1, NSW_2, NSW_3, NSW_4)


# NT
NT_1 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/NT.xls", 
                   sheet = "Table_6", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2015-07` = `no.__11`, `2015-08` = `no.__12`, `2015-09` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = grepl("(TR)", Category), yes = Category, no = NA)) %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "Northern Territory", yes = "Northern Territory", no = TR_CODE15)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(Category != TR_CODE15) %>% 
  filter(TR_CODE15 != "Northern Territory") %>% 
  filter(Category == "Hotels, motels and serviced apartments") %>% 
  gather(`2015-07`:`2015-09`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category) 

NT_2 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/NT.xls", 
                   sheet = "Table_7", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2015-10` = `no.__11`, `2015-11` = `no.__12`, `2015-12` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = grepl("(TR)", Category), yes = Category, no = NA)) %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "Northern Territory", yes = "Northern Territory", no = TR_CODE15)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(Category != TR_CODE15) %>% 
  filter(TR_CODE15 != "Northern Territory") %>% 
  filter(Category == "Hotels, motels and serviced apartments") %>% 
  gather(`2015-10`:`2015-12`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category)

NT_3 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/NT.xls", 
                   sheet = "Table_8", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2016-01` = `no.__11`, `2016-02` = `no.__12`, `2016-03` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = grepl("(TR)", Category), yes = Category, no = NA)) %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "Northern Territory", yes = "Northern Territory", no = TR_CODE15)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(Category != TR_CODE15) %>% 
  filter(TR_CODE15 != "Northern Territory") %>% 
  filter(Category == "Hotels, motels and serviced apartments") %>% 
  gather(`2016-01`:`2016-03`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category)

NT_4 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/NT.xls", 
                   sheet = "Table_9", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2016-04` = `no.__11`, `2016-05` = `no.__12`, `2016-06` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = grepl("(TR)", Category), yes = Category, no = NA)) %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "Northern Territory", yes = "Northern Territory", no = TR_CODE15)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(Category != TR_CODE15) %>% 
  filter(TR_CODE15 != "Northern Territory") %>% 
  filter(Category == "Hotels, motels and serviced apartments") %>% 
  gather(`2016-04`:`2016-06`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category)

NT <- rbind(NT_1, NT_2, NT_3, NT_4) %>% 
  mutate(State_short = "NT") %>% 
  mutate(State_long = "Northern Territory")

rm(NT_1, NT_2, NT_3, NT_4)


# Qld
Qld_1 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/Qld.xlsx", 
                    sheet = "Table_6", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2015-07` = `no.__11`, `2015-08` = `no.__12`, `2015-09` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = grepl("(TR)", Category), yes = Category, no = NA)) %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "Queensland", yes = "Queensland", no = TR_CODE15)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(Category != TR_CODE15) %>% 
  filter(TR_CODE15 != "Queensland") %>% 
  filter(Category == "Hotels, motels and serviced apartments") %>% 
  gather(`2015-07`:`2015-09`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category) 

Qld_2 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/Qld.xlsx", 
                    sheet = "Table_7", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2015-10` = `no.__11`, `2015-11` = `no.__12`, `2015-12` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = grepl("(TR)", Category), yes = Category, no = NA)) %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "Queensland", yes = "Queensland", no = TR_CODE15)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(Category != TR_CODE15) %>% 
  filter(TR_CODE15 != "Queensland") %>% 
  filter(Category == "Hotels, motels and serviced apartments") %>% 
  gather(`2015-10`:`2015-12`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category) 

Qld_3 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/Qld.xlsx", 
                    sheet = "Table_8", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2016-01` = `no.__11`, `2016-02` = `no.__12`, `2016-03` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = grepl("(TR)", Category), yes = Category, no = NA)) %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "Queensland", yes = "Queensland", no = TR_CODE15)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(Category != TR_CODE15) %>% 
  filter(TR_CODE15 != "Queensland") %>% 
  filter(Category == "Hotels, motels and serviced apartments") %>% 
  gather(`2016-01`:`2016-03`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category)

Qld_4 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/Qld.xlsx", 
                    sheet = "Table_9", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2016-04` = `no.__11`, `2016-05` = `no.__12`, `2016-06` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = grepl("(TR)", Category), yes = Category, no = NA)) %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "Queensland", yes = "Queensland", no = TR_CODE15)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(Category != TR_CODE15) %>% 
  filter(TR_CODE15 != "Queensland") %>% 
  filter(Category == "Hotels, motels and serviced apartments") %>% 
  gather(`2016-04`:`2016-06`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category)

Qld <- rbind(Qld_1, Qld_2, Qld_3, Qld_4) %>% 
  mutate(State_short = "Qld") %>% 
  mutate(State_long = "Queensland")

rm(Qld_1, Qld_2, Qld_3, Qld_4)


# SA
SA_1 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/SA.xls", 
                   sheet = "Table_6", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2015-07` = `no.__11`, `2015-08` = `no.__12`, `2015-09` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = grepl("(TR)", Category), yes = Category, no = NA)) %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "South Australia", yes = "South Australia", no = TR_CODE15)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(Category != TR_CODE15) %>% 
  filter(TR_CODE15 != "South Australia") %>% 
  filter(Category == "Hotels, motels and serviced apartments") %>% 
  gather(`2015-07`:`2015-09`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category) 

SA_2 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/SA.xls", 
                   sheet = "Table_7", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2015-10` = `no.__11`, `2015-11` = `no.__12`, `2015-12` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = grepl("(TR)", Category), yes = Category, no = NA)) %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "South Australia", yes = "South Australia", no = TR_CODE15)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(Category != TR_CODE15) %>% 
  filter(TR_CODE15 != "South Australia") %>% 
  filter(Category == "Hotels, motels and serviced apartments") %>% 
  gather(`2015-10`:`2015-12`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category)

SA_3 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/SA.xls", 
                   sheet = "Table_8", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2016-01` = `no.__11`, `2016-02` = `no.__12`, `2016-03` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = grepl("(TR)", Category), yes = Category, no = NA)) %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "South Australia", yes = "South Australia", no = TR_CODE15)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(Category != TR_CODE15) %>% 
  filter(TR_CODE15 != "South Australia") %>% 
  filter(Category == "Hotels, motels and serviced apartments") %>% 
  gather(`2016-01`:`2016-03`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category)

SA_4 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/SA.xls", 
                   sheet = "Table_9", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2016-04` = `no.__11`, `2016-05` = `no.__12`, `2016-06` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = grepl("(TR)", Category), yes = Category, no = NA)) %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "South Australia", yes = "South Australia", no = TR_CODE15)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(Category != TR_CODE15) %>% 
  filter(TR_CODE15 != "South Australia") %>% 
  filter(Category == "Hotels, motels and serviced apartments") %>% 
  gather(`2016-04`:`2016-06`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category)

SA <- rbind(SA_1, SA_2, SA_3, SA_4) %>% 
  mutate(State_short = "SA") %>% 
  mutate(State_long = "South Australia")

rm(SA_1, SA_2, SA_3, SA_4)


# Tas
Tas_1 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/Tas.xls", 
                    sheet = "Table_6", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2015-07` = `no.__11`, `2015-08` = `no.__12`, `2015-09` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2017") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = grepl("(TR)", Category), yes = Category, no = NA)) %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "Tasmania", yes = "Tasmania", no = TR_CODE15)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(Category != TR_CODE15) %>% 
  filter(TR_CODE15 != "Tasmania") %>% 
  filter(Category == "Hotels, motels and serviced apartments") %>% 
  gather(`2015-07`:`2015-09`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category)

Tas_2 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/Tas.xls", 
                    sheet = "Table_7", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2015-10` = `no.__11`, `2015-11` = `no.__12`, `2015-12` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2017") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = grepl("(TR)", Category), yes = Category, no = NA)) %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "Tasmania", yes = "Tasmania", no = TR_CODE15)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(Category != TR_CODE15) %>% 
  filter(TR_CODE15 != "Tasmania") %>% 
  filter(Category == "Hotels, motels and serviced apartments") %>% 
  gather(`2015-10`:`2015-12`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category)

Tas_3 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/Tas.xls", 
                    sheet = "Table_8", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2016-01` = `no.__11`, `2016-02` = `no.__12`, `2016-03` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2017") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = grepl("(TR)", Category), yes = Category, no = NA)) %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "Tasmania", yes = "Tasmania", no = TR_CODE15)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(Category != TR_CODE15) %>% 
  filter(TR_CODE15 != "Tasmania") %>% 
  filter(Category == "Hotels, motels and serviced apartments") %>% 
  gather(`2016-01`:`2016-03`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category)

Tas_4 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/Tas.xls", 
                    sheet = "Table_9", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2016-04` = `no.__11`, `2016-05` = `no.__12`, `2016-06` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2017") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = grepl("(TR)", Category), yes = Category, no = NA)) %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "Tasmania", yes = "Tasmania", no = TR_CODE15)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(Category != TR_CODE15) %>% 
  filter(TR_CODE15 != "Tasmania") %>% 
  filter(Category == "Hotels, motels and serviced apartments") %>% 
  gather(`2016-04`:`2016-06`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category)

Tas <- rbind(Tas_1, Tas_2, Tas_3, Tas_4) %>% 
  mutate(State_short = "Tas") %>% 
  mutate(State_long = "Tasmania")

rm(Tas_1, Tas_2, Tas_3, Tas_4)


# Vic
Vic_1 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/Vic.xlsx", 
                    sheet = "Table_6", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2015-07` = `no.__11`, `2015-08` = `no.__12`, `2015-09` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = grepl("(TR)", Category), yes = Category, no = NA)) %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "Victoria", yes = "Victoria", no = TR_CODE15)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(Category != TR_CODE15) %>% 
  filter(TR_CODE15 != "Victoria") %>% 
  filter(Category == "Hotels, motels and serviced apartments") %>% 
  gather(`2015-07`:`2015-09`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category)

Vic_2 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/Vic.xlsx", 
                    sheet = "Table_7", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2015-10` = `no.__11`, `2015-11` = `no.__12`, `2015-12` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = grepl("(TR)", Category), yes = Category, no = NA)) %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "Victoria", yes = "Victoria", no = TR_CODE15)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(Category != TR_CODE15) %>% 
  filter(TR_CODE15 != "Victoria") %>% 
  filter(Category == "Hotels, motels and serviced apartments") %>% 
  gather(`2015-10`:`2015-12`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category)

Vic_3 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/Vic.xlsx", 
                    sheet = "Table_8", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2016-01` = `no.__11`, `2016-02` = `no.__12`, `2016-03` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = grepl("(TR)", Category), yes = Category, no = NA)) %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "Victoria", yes = "Victoria", no = TR_CODE15)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(Category != TR_CODE15) %>% 
  filter(TR_CODE15 != "Victoria") %>% 
  filter(Category == "Hotels, motels and serviced apartments") %>% 
  gather(`2016-01`:`2016-03`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category)

Vic_4 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/Vic.xlsx", 
                    sheet = "Table_9", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2016-04` = `no.__11`, `2016-05` = `no.__12`, `2016-06` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = grepl("(TR)", Category), yes = Category, no = NA)) %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "Victoria", yes = "Victoria", no = TR_CODE15)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(Category != TR_CODE15) %>% 
  filter(TR_CODE15 != "Victoria") %>% 
  filter(Category == "Hotels, motels and serviced apartments") %>% 
  gather(`2016-04`:`2016-06`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category)

Vic <- rbind(Vic_1, Vic_2, Vic_3, Vic_4) %>% 
  mutate(State_short = "Vic") %>% 
  mutate(State_long = "Victoria")

rm(Vic_1, Vic_2, Vic_3, Vic_4)


# WA
WA_1 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/WA.xls", 
                   sheet = "Table_6", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2015-07` = `no.__11`, `2015-08` = `no.__12`, `2015-09` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = grepl("(TR)", Category), yes = Category, no = NA)) %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "Western Australia", yes = "Western Australia", no = TR_CODE15)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(Category != TR_CODE15) %>% 
  filter(TR_CODE15 != "Western Australia") %>% 
  filter(Category == "Hotels, motels and serviced apartments") %>% 
  gather(`2015-07`:`2015-09`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category)

WA_2 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/WA.xls", 
                   sheet = "Table_7", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2015-10` = `no.__11`, `2015-11` = `no.__12`, `2015-12` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = grepl("(TR)", Category), yes = Category, no = NA)) %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "Western Australia", yes = "Western Australia", no = TR_CODE15)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(Category != TR_CODE15) %>% 
  filter(TR_CODE15 != "Western Australia") %>% 
  filter(Category == "Hotels, motels and serviced apartments") %>% 
  gather(`2015-10`:`2015-12`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category)

WA_3 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/WA.xls", 
                   sheet = "Table_8", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2016-01` = `no.__11`, `2016-02` = `no.__12`, `2016-03` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = grepl("(TR)", Category), yes = Category, no = NA)) %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "Western Australia", yes = "Western Australia", no = TR_CODE15)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(Category != TR_CODE15) %>% 
  filter(TR_CODE15 != "Western Australia") %>% 
  filter(Category == "Hotels, motels and serviced apartments") %>% 
  gather(`2016-01`:`2016-03`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category) 

WA_4 <- read_excel("./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/raw/WA.xls", 
                   sheet = "Table_9", skip = 6) %>% 
  dplyr::rename(Category = X__1, 
                `2016-04` = `no.__11`, `2016-05` = `no.__12`, `2016-06` = `no.__13`) %>% 
  select(Category, starts_with("20")) %>% 
  filter(!is.na(Category)) %>% 
  filter(Category != "© Commonwealth of Australia 2016") %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = grepl("(TR)", Category), yes = Category, no = NA)) %>% 
  dplyr::mutate(TR_CODE15 = ifelse(test = Category == "Western Australia", yes = "Western Australia", no = TR_CODE15)) %>% 
  tidyr::fill(TR_CODE15) %>% 
  filter(Category != TR_CODE15) %>% 
  filter(TR_CODE15 != "Western Australia") %>% 
  filter(Category == "Hotels, motels and serviced apartments") %>% 
  gather(`2016-04`:`2016-06`, key = "date", value = "GNO") %>% 
  select(TR_CODE15, date, everything()) %>% 
  arrange(TR_CODE15, date, Category)

WA <- rbind(WA_1, WA_2, WA_3, WA_4) %>% 
  mutate(State_short = "WA") %>% 
  mutate(State_long = "Western Australia")

rm(WA_1, WA_2, WA_3, WA_4)

# All
TA_TR_GNO_15_16_all <- rbind(ACT, NSW, NT, Qld, SA, Tas, Vic, WA) %>% 
  mutate(TR_CODE15 = str_replace(TR_CODE15, coll(" (TR)"), ""))

rm(ACT, NSW, NT, Qld, SA, Tas, Vic, WA) 

# table(TA_TR_GNO_15_16_all$date)
# table(TA_TR_GNO_15_16_all$TR_CODE15)
```


# Results - state level

## Data structure

```{r, results='asis'}
# skim(TA_STA_PPR_15_16)
skim(TA_STA_PPR_15_16) %>% skimr::kable()
```

## Monthly time trends in PPR

```{r}
# ggplot(TA_STA_PPR_15_16, aes(date, PPR, group = Category, colour = Category))+ 
#   geom_line(size = 1) +
#   facet_wrap(~STE_NAME16, ncol = 2)

TA_STA_PPR_15_16 %>% 
  mutate(date = stringr::str_sub(date, start = 3)) %>% 
  ggplot(aes(date, PPR, group = Category, colour = Category)) +
  geom_line() +
  facet_geo(~ State_short, grid = "aus_grid1") +
  labs(
    title = "Monthly number of guests per room in tourist accomodation of Australia",
    caption = "Data Source: ABS Tourist Accommodation, Australia, 2015-16",
    y = "Guests per room", x = "") +
  theme_light() +
  theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust = 1),
        legend.position = c(0.1, 0.1))
```


# Results - TR level data

## Data structure  - aggregated

```{r, results='asis'}
# skim(TA_TR_GNO_15_16_all)
skim(TA_TR_GNO_15_16_all) %>% skimr::kable()
```

## Data structure  - detailed

```{r, results='asis'}
# skim(TA_TR_GNO_15_16)
skim(TA_TR_GNO_15_16) %>% skimr::kable()
```

## Monthly time trends in GNO (aggregated, absolute)

```{r}
ggplot(TA_TR_GNO_15_16_all, aes(date, GNO, group = TR_CODE15, colour = State_short))+
  geom_line()
```

## Monthly time trends in GNO (detailed, absolute)

```{r}
ggplot(TA_TR_GNO_15_16, aes(date, GNO, group = TR_CODE15, colour = State_short))+
  geom_line() +
  facet_wrap(~Category, ncol = 1)
```

## Monthly time trends in GNO (aggregated, relative)

```{r, include=FALSE}
temp <- TA_TR_GNO_15_16_all %>% 
  group_by(TR_CODE15) %>% 
  dplyr::summarize( GNO_tot = sum(GNO)) %>% 
  select(TR_CODE15, GNO_tot)

TA_TR_GNO_15_16 <- join(TA_TR_GNO_15_16, temp, kind = "left", gen = "_merge") %>% 
  mutate(GNO_perc = (GNO / GNO_tot) *100)

# tab(TA_TR_GNO_15_16, `_merge`)
TA_TR_GNO_15_16 %<>% 
  select(-`_merge`)


TA_TR_GNO_15_16_all <- join(TA_TR_GNO_15_16_all, temp, kind = "left", gen = "_merge") %>% 
  mutate(GNO_perc = (GNO / GNO_tot) *100)

# tab(TA_TR_GNO_15_16_all, `_merge`)
TA_TR_GNO_15_16_all %<>% 
  select(-`_merge`)


saveRDS(TA_TR_GNO_15_16, file = "./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/clean/TA_TR_GNO_15_16.rds")
write_csv(TA_TR_GNO_15_16, "./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/clean/TA_TR_GNO_15_16.csv")

saveRDS(TA_TR_GNO_15_16_all, file = "./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/clean/TA_TR_GNO_15_16_all.rds")
write_csv(TA_TR_GNO_15_16_all, "./Data/ABS/8635.0 Tourist Accommodation, Australia, 2015-16/clean/TA_TR_GNO_15_16_all.csv")
```

```{r}
ggplot(TA_TR_GNO_15_16_all, aes(date, GNO_perc, group = TR_CODE15, colour = State_short))+
  geom_line() +
  labs(y = "GNO (% yearly total within TR)", x = "") 
```

## Monthly time trends in GNO (detailed, relative)

```{r}
ggplot(TA_TR_GNO_15_16, aes(date, GNO_perc, group = TR_CODE15, colour = State_short))+
  geom_line() +
  facet_wrap(~Category, ncol = 1) +
  labs(y = "GNO (% yearly total within TR)", x = "") 
```