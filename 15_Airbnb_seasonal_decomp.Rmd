---
title: "Airbnb - seasonality"
# subtitle: "Monthly relative income on SA2 level"
# author: "Radoslaw Panczak"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
  html_document: 
    highlight: pygments
    number_sections: yes
    theme: united
    toc: yes
    toc_depth: 4
---

<!-- ------------------------------------------------------------ --> 
<!-- ------------------------------------------------------------ --> 

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, fig.width=6, fig.height=3.75, dpi=300, out.width="600px", out.height="375px")
# knitr::opts_knit$set(root.dir = 'R:/AIRBNB-Q0931')
# setwd('R:/AIRBNB-Q0931')

set.seed(12345)

library(pacman) 
p_load(tidyverse, magrittr, forecast)

```

# Data 

```{r}
monthly_new_select <- readRDS("./data/airdna/clean/monthly_new_select.Rds")

airbnb_month_agg <- monthly_new_select %>% 
  group_by(reporting_month) %>% 
  summarise(
    number_of_reservations = sum(number_of_reservations, na.rm = TRUE),
    reservation_days = sum(reservation_days, na.rm = TRUE),
    revenue_native = sum(revenue_native, na.rm = TRUE)
  ) %>% 
  filter(reporting_month >= as.Date("2016-01-01"))

# write_csv(airbnb_month_agg, "C:/Users/uqrpancz/Desktop/upload.csv")

```

`r nrow(airbnb_month_agg)` records of monthly aggregated values for whole Oz. 

# Time series

## No of reservations

```{r}
reservations_ts = ts(airbnb_month_agg[[2]], start = c(2016, 1), frequency = 12)
ggplot2::autoplot(reservations_ts)
ggseasonplot(reservations_ts)
ggAcf(reservations_ts)

```

## Reservation days

```{r}
days_ts = ts(airbnb_month_agg[[3]], start = c(2016, 1), frequency = 12)
ggplot2::autoplot(days_ts)
ggseasonplot(days_ts)
ggAcf(days_ts)

```

## Revenue 

```{r}
revenue_ts = ts(airbnb_month_agg[[4]], start = c(2016, 1), frequency = 12)
ggplot2::autoplot(revenue_ts)
ggseasonplot(revenue_ts)#, polar=TRUE)
ggAcf(revenue_ts)

```

```{r}
# monthplot(reservations_ts)
```

# Seasonality

## `decompose` function `stats` package

### No of reservations

```{r}
reservations_ts %>% decompose(type="multi") %>%
  autoplot() + xlab("Year") 
```

### Reservation days

```{r}
days_ts %>% decompose(type="multi") %>%
  autoplot() + xlab("Year") 
```

### Revenue 

```{r}
revenue_ts %>% decompose(type="multi") %>%
  autoplot() + xlab("Year") 
```


## `stl` function `stats` package

### No of reservations

```{r}
stl(reservations_ts, s.window="per", robust=TRUE) %>% 
  autoplot() + xlab("Year") 
```

### Reservation days

```{r}
stl(days_ts, s.window="per", robust=TRUE) %>% 
  autoplot() + xlab("Year") 
```

### Revenue 

```{r}
stl(revenue_ts, s.window="per", robust=TRUE) %>% 
  autoplot() + xlab("Year") 
```



## `AutoSTR` function `stR` package

```{r}
p_load(stR)
```

### No of reservations

```{r}
plot(AutoSTR(reservations_ts))
```

### Reservation days

```{r}
plot(AutoSTR(days_ts))
```

### Revenue 

```{r}
plot(AutoSTR(revenue_ts))
```



## `seasonal` package `x11` method

### Reservation days

```{r}
p_load(seasonal)

# reservations <- seas(reservations_ts, x11="")
# revenue <- seas(revenue_ts, x11="")
days <- seas(days_ts, x11="")

autoplot(days)

# p_load(seasonalview)
# view(days)
```



## `seasonal` package `SEATS` method

### Reservation days

```{r}
# reservations <- seas(reservations_ts, x11="")
# revenue <- seas(revenue_ts, x11="")
days <- seas(days_ts)

autoplot(days)
# view(days)
```








